---
tags:
  - monitoring
---
# PromQL

## Описание

PromQL (Prometheus Query Language) — это функциональный язык запросов, созданный специально для работы с временными рядами данных в системе мониторинга Prometheus. Он позволяет выбирать, агрегировать и анализировать метрики в реальном времени, предоставляя мощные средства для мониторинга и визуализации.

PromQL работает с четырьмя основными типами данных: мгновенными векторами (instant vectors), диапазонными векторами (range vectors), скалярами и строками. Запросы могут быть как мгновенными (оценка в одной точке времени), так и диапазонными (серия значений за интервал времени).

Основная идея PromQL — работать с метриками, которые представляют собой временные ряды, индексируемые по меткам (labels). Метки позволяют фильтровать и группировать данные по различным параметрам (например, по имени сервиса, группе, типу запроса).

## Основные возможности и синтаксис

- **Извлечение метрик по имени:**  
  http_requests_total  
  Возвращает все значения метрики `http_requests_total` в текущий момент.

- **Фильтрация по меткам:**  
  http_requests_total{job="prometheus", group="canary"}  
  Возвращает значения метрики с указанными метками. Это называется мгновенным вектором (instant vector).

- **Диапазонные запросы:**  
  http_requests_total{job="prometheus"}[5m]  
  Возвращает данные за последние 5 минут (range vector).

- **Агрегации:**  
  PromQL поддерживает функции агрегации, такие как `sum()`, `avg()`, `min()`, `max()`, которые позволяют суммировать, усреднять и находить экстремумы по выбранным метрикам.

- **Операторы и выражения:**  
  Можно использовать арифметические операторы (`+`, `-`, `*`, `/`), логические операторы и функции для сложных вычислений и трансформаций метрик.

- **Временные функции:**  
  Поддерживаются функции для работы с временными интервалами, например, `rate()`, `increase()`, которые помогают анализировать скорость изменения метрик.

## Типы данных в PromQL

- **Instant Vector (мгновенный вектор):** набор временных рядов с текущими значениями.
- **Range Vector (диапазонный вектор):** набор временных рядов с историческими значениями за указанный интервал.
- **Scalar (скаляр):** одиночное числовое значение.
- **String (строка):** текстовое значение.

## Пример простого запроса

http_requests_total{job="prometheus"}

Этот запрос вернёт все текущие значения метрики `http_requests_total` для сервиса с меткой `job="prometheus"`.

## Применение

PromQL используется для:

- Мониторинга состояния систем и приложений.
- Создания дашбордов с визуализацией метрик.
- Настройки правил оповещений (Alerting).
- Анализа производительности и выявления аномалий.

## Ресурсы для изучения

- [Что такое PromQL и как с ним работать — Timeweb](https://timeweb.com/ru/community/articles/chto-takoe-promql-i-kak-s-nim-rabotat)  
- [Документация Prometheus: Querying basics](https://prometheus.io/docs/prometheus/latest/querying/basics/)  
- [Запрос метрик Prometheus с помощью API и PromQL — Azure Monitor](https://learn.microsoft.com/ru-ru/azure/azure-monitor/essentials/prometheus-api-promql)  
- [Статья на Хабр: Человеческим языком про метрики 4: PromQL](https://habr.com/ru/companies/tochka/articles/693834/)  
- [GitHub: Документация по PromQL в StatsHouse](https://github.com/VKCOM/statshouse/blob/master/docs/promql.ru.md)  

---

PromQL — это мощный и гибкий язык запросов для анализа временных рядов в Prometheus, позволяющий выполнять сложные выборки и агрегации метрик для эффективного мониторинга и управления инфраструктурой.
