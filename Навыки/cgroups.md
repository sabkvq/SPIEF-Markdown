---
tags:
  - virtualization
---
# Описание

Cgroups (control groups) — это механизм ядра Linux, позволяющий группировать процессы в иерархические контролируемые группы для управления и ограничения потребления системных ресурсов, таких как процессорное время, память, ввод-вывод и сеть. Он обеспечивает изоляцию, учет и контроль ресурсов на уровне набора процессов, что позволяет эффективно управлять производительностью и стабильностью системы.

## Инструменты

- Команды для управления cgroups: `cgcreate`, `cgexec`, `cgset`, `cgdelete` (часть пакета libcgroup-tools).
    
- Работа через файловую систему cgroupfs, где создаются и настраиваются группы.
    
- Интеграция с systemd для автоматического управления cgroups.
    
- Использование в контейнерных технологиях (Docker, LXC, libvirt).
    

## Связь с другими навыками

|Технология|Взаимодействие|
|---|---|
|Docker|Использует cgroups для ограничения ресурсов контейнеров|
|systemd|Управляет cgroups для сервисов и процессов|
|LXC|Контейнеризация на базе cgroups и namespaces|
|Linux Kernel|Реализация и поддержка механизма cgroups|
|Мониторинг (например, [[Prometheus]])|Сбор метрик использования ресурсов через cgroups|

## Архитектура и основные понятия

Механизм cgroups состоит из двух основных частей: ядра (cgroup core) и подсистем (контроллеров ресурсов). Подсистемы отвечают за управление конкретными ресурсами:

- `cpu` — управление доступом к процессору;
    
- `cpuacct` — учет использования CPU;
    
- `cpuset` — распределение задач по ядрам процессора и памяти;
    
- `memory` — управление потреблением оперативной памяти;
    
- `blkio` — контроль ввода-вывода на блочных устройствах;
    
- `devices` — контроль доступа к устройствам;
    
- `freezer` — приостановка и возобновление процессов;
    
- `net_cls` и `netprio` — управление сетевыми пакетами и приоритетами;
    
- `pids` — ограничение количества процессов.
    

Cgroups организованы в иерархии, где ограничения наследуются дочерними группами, что позволяет гибко конфигурировать управление ресурсами.

# Практика

## Оценка уровня навыка

|Уровень|Описание|Ключевые навыки|Критерии оценки|
|---|---|---|---|
|Junior|Знаком с концепцией cgroups|Понимание основных подсистем|Может создавать и управлять простыми cgroups|
|Middle|Умеет настраивать ограничения ресурсов|Использование команд и systemd для cgroups|Настраивает cgroups для сервисов и контейнеров|
|Senior|Оптимизирует производительность системы|Интеграция cgroups с мониторингом и контейнерами|Автоматизирует управление ресурсами и решает конфликты|
|Expert|Разрабатывает и поддерживает ядро Linux|Глубокое понимание архитектуры cgroups|Вносит изменения в ядро, создает новые контроллеры|

## Бизнес-ценность и использование в работе

|Применение|Описание|Преимущества|Рекомендации по использованию|
|---|---|---|---|
|Контейнеризация|Ограничение ресурсов для контейнеров|Изоляция, предотвращение перегрузок|Использовать совместно с Docker, Kubernetes|
|Управление сервисами|Контроль ресурсов для системных и пользовательских сервисов|Повышение стабильности и производительности|Интегрировать с systemd|
|Мониторинг|Сбор метрик использования ресурсов|Анализ и оптимизация нагрузки|Настроить сбор метрик через cgroups|
|Безопасность|Ограничение доступа к устройствам и ресурсам|Защита от злоупотреблений и DoS-атак|Ограничивать права доступа через подсистему devices|

## Pet-project

|Уровень|Название проекта|Описание|Технологии|Критерий успеха|Вспомогательные ссылки|
|---|---|---|---|---|---|
|Junior|Управление ресурсами|Создание cgroup для ограничения памяти|Linux, libcgroup-tools|Группа ограничила память процесса|habr.com, timeweb.cloud|
|Middle|Контейнер на cgroups|Запуск изолированного процесса с ограничениями|Linux, Docker|Контейнер работает с заданными лимитами|habr.com, github.com|
|Senior|Мониторинг cgroups|Сбор и визуализация метрик использования ресурсов|[[Prometheus]], [[Grafana]]|Метрики корректно отображаются|habr.com, timeweb.cloud|
|Expert|Разработка контроллера|Создание нового контроллера ресурсов для ядра|Linux Kernel|Контроллер интегрирован и работает|github.com/linux-insides|

## Траблшутинг

- Проверка текущих cgroups и их настроек через `cat /proc/self/cgroup` и `mount | grep cgroup`.
    
- Использование `systemd-cgls` и `systemd-cgtop` для визуализации и мониторинга.
    
- Логирование ошибок в системных журналах при работе с cgroups.
    
- Проверка ограничений и их наследования в иерархии.
    
- Отладка с помощью ручного управления через cgroupfs.
    

## Ресурсы, форумы

- Хабр — статьи по cgroups и контейнеризации
    
- Документация Linux kernel по cgroups
    
- GitHub — проекты и исходники по cgroups
    
- Форумы Linux и Stack Overflow — обсуждения и решения проблем
    
- Официальные руководства systemd и Docker
    
